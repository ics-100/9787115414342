## 第3章 完善MBR

* `Sat Jun  5 10:55:00 CST 2021`

**3.1.1 什么是地址**

* 地址只是数字，描述各种符号在源程序中的位置，它是源代码中各符号偏移文件开头的距离
* `ndisasm` 反汇编
* 地址等于上一个地址+上一个地址处内容的长度

**3.1.3 什么是 vstart**

* `virtual start address` 虚拟起始地址
* `vstart` 和 `org` 功能是一样的，把后面所有数据地址以 `xxx`  开始编


**3.2.2 实模式下的寄存器**

* 高端内存区(High Memory Area, HMA)
* 地址回卷

**3.2.4 实模式下CPU内存寻址方式**

* 寄存器寻址
* 立即数寻址
* 内存寻址： 直接/基址/变址/基址变址
* 最终起决定作用的、有效的是段内偏移地址，所以段内偏移地址称为有效地址 

1 - 基址寻址

* bx寄存器的默认段寄存器是DS， bp寄存器的默认段寄存器是SS
* sp 寄存器作为栈顶指针，相当于栈中数据的游标，这是专门给push指令和pop指令做导航用的寄存器
* 标志寄存器eflags 无法直接修改，只能用pushf把指令eflags寄存器的内容压到栈中，我们在栈中修改完成后，在用popf把它弹回到eflags中
* 一个最重要的应用就是在栈中保存局部变量和函数参数

2 - 变址寻址

*  寄存器由 bx、bp 换成了 si 和 di

3 - 基址变址寻址


**3.2.5 栈到底是什么玩意儿**


* 假如当前栈顶是0x1233E, 栈顶数据占2字节的话，其范围是0x1233E~0x1233F


**3.2.6 实模式下的ret**

* `ret(return)` 指令的功能是在栈顶弹出2字节的内容来替换IP寄存器
* `retf(return far) `是从栈顶取4字节，栈顶处的2字节用来替换IP寄存器，另外的2字节用来替换CS寄存器

**3.2.7 实模式下的call**

* `jmp`  属于一去不回头地去执行新的代码

1 - 16位实模式相对近调用(IP)
2 - 16位实模式间接绝对近调用(IP)
3 - 16位实模式直接绝对远调用(CS:IP)
4 - 16位实模式间接绝对远调用(CS:IP)


**3.3.3 显卡、显存、显示器**

* 显存是从 `0xB8000` 到 `0xBFFFF` 范围是32KB
* 一屏幕可以显示2000个字，显示器上每个自负占2个字节代销， 故每屏字符实际占用4000字节
* 我们32KB可以容纳约等于8屏的数据

### 3.4 bochs 调试方法 - @TODO

* `help command`
* `x` 线性地址 / `xp` 物理地址 
* bochs 中用到的字并不是2字节，而是4字节
* 显示单元, 默认4字节, 指定显示单元后，以后就以此显示单元为准,不会自动恢复为默认的4字节
* u ，用来将内存数据反汇编成指令

### 3.5 硬盘介绍

